<!-- variables -->
<input type="hidden" name="attr_str_save_bonus" title="@{str_save_bonus}" value="@{str_save_bonus}">
<input type="hidden" name="attr_dex_save_bonus" title="@{dex_save_bonus}" value="@{dex_save_bonus}">
<input type="hidden" name="attr_con_save_bonus" title="@{con_save_bonus}" value="@{con_save_bonus}">
<input type="hidden" name="attr_int_save_bonus" title="@{int_save_bonus}" value="@{int_save_bonus}">
<input type="hidden" name="attr_wis_save_bonus" title="@{wis_save_bonus}" value="@{wis_save_bonus}">
<input type="hidden" name="attr_cha_save_bonus" title="@{cha_save_bonus}" value="@{cha_save_bonus}">

<input type="hidden" name="attr_ath_skill_bonus" title="@{ath_skill_bonus}" value="@{ath_skill_bonus}">
<input type="hidden" name="attr_acr_skill_bonus" title="@{acr_skill_bonus}" value="@{acr_skill_bonus}">
<input type="hidden" name="attr_sle_skill_bonus" title="@{sle_skill_bonus}" value="@{sle_skill_bonus}">
<input type="hidden" name="attr_ste_skill_bonus" title="@{ste_skill_bonus}" value="@{ste_skill_bonus}">
<input type="hidden" name="attr_arc_skill_bonus" title="@{arc_skill_bonus}" value="@{arc_skill_bonus}">
<input type="hidden" name="attr_his_skill_bonus" title="@{his_skill_bonus}" value="@{his_skill_bonus}">
<input type="hidden" name="attr_inv_skill_bonus" title="@{inv_skill_bonus}" value="@{inv_skill_bonus}">
<input type="hidden" name="attr_nat_skill_bonus" title="@{nat_skill_bonus}" value="@{nat_skill_bonus}">
<input type="hidden" name="attr_rel_skill_bonus" title="@{rel_skill_bonus}" value="@{rel_skill_bonus}">
<input type="hidden" name="attr_ani_skill_bonus" title="@{ani_skill_bonus}" value="@{ani_skill_bonus}">
<input type="hidden" name="attr_ins_skill_bonus" title="@{ins_skill_bonus}" value="@{ins_skill_bonus}">
<input type="hidden" name="attr_med_skill_bonus" title="@{med_skill_bonus}" value="@{med_skill_bonus}">
<input type="hidden" name="attr_per_skill_bonus" title="@{per_skill_bonus}" value="@{pre_skill_bonus}">
<input type="hidden" name="attr_sur_skill_bonus" title="@{sur_skill_bonus}" value="@{sur_skill_bonus}">
<input type="hidden" name="attr_dec_skill_bonus" title="@{dec_skill_bonus}" value="@{dec_skill_bonus}">
<input type="hidden" name="attr_inti_skill_bonus" title="@{inti_skill_bonus}" value="@{inti_skill_bonus}">
<input type="hidden" name="attr_perf_skill_bonus" title="@{perf_skill_bonus}" value="@{perf_skill_bonus}">
<input type="hidden" name="attr_pers_skill_bonus" title="@{pers_skill_bonus}" value="@{pers_skill_bonus}">

<div class="sheet-crooked-moon">
    <input type="hidden" class="sheet-card-toggle" name="attr_sheet_card" value="null">
    <div class="sheet-choice">
        <span>What sheet do u choose?</span>
        <button type="action" name="act_sheet-toggle-npc" class="sheet-button-0">[NPC]</button>
        <button type="action" name="act_sheet-toggle-pc" class="sheet-button-1">[PC]</button>
    </div>
    <div class="sheet-section-npc">
        <span>Goblin</span>
    </div>
    <div class="sheet-section-pc">

        <!-- character sheet // skills // page 1 -->

        <div class="sheet-toggle-character-skills">
            <!-- COLUMN LEFT -->
            <div class="sheet-column-left">

            <div class="sheet-stat">
                <div>
                    <button type="roll" name="roll_str" value="&{template:stat} {{name=Strength}} {{roll=[[1d20+@{str_mod}]]}} {{mod=@{str_mod}}}"> STRENGTH </button>
                </div>
                <div class="scores-values">
                    <div class="modifier">
                        <input type="number" name="attr_str_mod" value="@{str_mod}" readonly>
                        <span>MODIFIER</span>
                    </div>
                    <div class="score">
                        <span>Score</span>
                        <input type="number" name="attr_str" value="10" title="@{str}" min="0">
                    </div>
                </div>
                <div class="skills">
                    <div> 
                        <input type="checkbox" name="attr_str_save" value="1">
                        <button type="roll" name="roll_str_save" value="&{template:stat} {{name=Strength Save}} {{roll=[[1d20+@{str_save_bonus}]]}} {{mod=@{str_save_bonus}}}">SAVING THROW</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_ath_skill_prof" value="1">
                        <button type="roll" name="roll_skill_ath" value="&{template:stat} {{name=Athletics}} {{roll=[[1d20+@{ath_skill_bonus}]]}} {{mod=@{ath_skill_bonus}}}">Athletics</button>
                    </div>
                </div>
            </div>

            <div class="sheet-stat">
                <div>
                    <button type="roll" name="roll_dex" value="&{template:stat} {{name=Dexterity}} {{roll=[[1d20+@{dex_mod}]]}} {{mod=@{dex_mod}}}">DEXTERITY</button>
                </div>
                <div class="scores-values">
                    <div class="modifier">
                        <input type="number" name="attr_dex_mod" value="@{dex_mod}" readonly>
                        <span>MODIFIER</span>
                    </div>
                    <div class="score">
                        <span>Score</span>
                        <input type="number" name="attr_dex" value="10" title="@{dex}" min="0">
                    </div>
                </div>
                <div class="skills">
                    <div>
                        <input type="checkbox" name="attr_dex_save" value="1">
                        <button type="roll" name="roll_dex_save" value="&{template:stat} {{name=Dexterity Save}} {{roll=[[1d20+@{dex_save_bonus}]]}} {{mod=@{dex_save_bonus}}}">SAVING THROW</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_acr_skill_prof" value="1">
                        <button type="roll" name="roll_skill_acr" value="&{template:stat} {{name=Acrobatics}} {{roll=[[1d20+@{acr_skill_bonus}]]}} {{mod=@{acr_skill_bonus}}}" >Acrobatics</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_sle_skill_prof" value="1">
                        <button type="roll" name="roll_skill_sle" value="&{template:stat} {{name=Sleight of Hand}} {{roll=[[1d20+@{sle_skill_bonus}]]}} {{mod=@{sle_skill_bonus}}}">Sleight of Hand</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_ste_skill_prof" value="1">
                        <button type="roll" name="roll_skill_ste" value="&{template:stat} {{name=Stealth}} {{roll=[[1d20+@{ste_skill_bonus}]]}} {{mod=@{ste_skill_bonus}}}">Stealth</button>
                    </div>
                </div>

            </div>
            <div class="sheet-stat">
                <div>
                    <button type="roll" name="roll_con" value="&{template:stat} {{name=CONSTITUTION}} {{roll=[[1d20+@{con_mod}]]}} {{mod=@{con_mod}}}">CONSTITUTION</button>
                </div>
                <div class="scores-values">
                    <div class="modifier">
                        <input type="number" name="attr_con_mod" value="@{con_mod}" readonly>
                        <span>MODIFIER</span>
                    </div>
                    <div class="score">
                        <span>Score</span>
                        <input type="number" name="attr_con" value="10" title="@{con}" min="0">
                    </div>
                </div>
                <div class="skills">
                    <div>
                        <input type="checkbox" name="attr_con_save" value="1">
                        <button type="roll" name="roll_con_save" value="&{template:stat} {{name=Constitution Save}} {{roll=[[1d20+@{con_save_bonus}]]}} {{mod=@{con_save_bonus}}}">SAVING THROW</button>
                    </div>
                </div>
            </div>

            <div class="sheet-stat">
                <div>
                    <button type="roll" name="roll_con" value="&{template:stat} {{name=INTELLIGENCE}} {{roll=[[1d20+@{int_mod}]]}} {{mod=@{int_mod}}}">INTELLIGENCE</button>
                </div>
                <div class="scores-values">
                    <div class="modifier">
                        <input type="number" name="attr_int_mod" value="@{int_mod}" readonly>
                        <span>MODIFIER</span>
                    </div>
                    <div class="score">
                        <span>Score</span>
                        <input type="number" name="attr_int" value="10" title="@{int}" min="0">
                    </div>
                </div>
                <div class="skills">
                    <div>
                        <input type="checkbox" name="attr_int_save" value="1">
                        <button type="roll" name="roll_int_save" value="&{template:stat} {{name=Intelligence Save}} {{roll=[[1d20+@{int_save_bonus}]]}} {{mod=@{int_save_bonus}}}">SAVING THROW</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_arc_skill_prof" value="1">
                        <button type="roll" name="roll_skill_arc" value="&{template:stat} {{name=Arcana}} {{roll=[[1d20+@{arc_skill_bonus}]]}} {{mod=@{arc_skill_bonus}}}">Arcana</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_his_skill_prof" value="1">
                        <button type="roll" name="roll_skill_his" value="&{template:stat} {{name=History}} {{roll=[[1d20+@{his_skill_bonus}]]}} {{mod=@{his_skill_bonus}}}">History</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_inv_skill_prof" value="1">
                        <button type="roll" name="roll_skill_inv" value="&{template:stat} {{name=Invesigation}} {{roll=[[1d20+@{inv_skill_bonus}]]}} {{mod=@{inv_skill_bonus}}}">Invesigation</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_nat_skill_prof" value="1">
                        <button type="roll" name="roll_skill_nat" value="&{template:stat} {{name=Nature}} {{roll=[[1d20+@{nat_skill_bonus}]]}} {{mod=@{nat_skill_bonus}}}">Nature</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_rel_skill_prof" value="1">
                        <button type="roll" name="roll_skill_rel" value="&{template:stat} {{name=Religion}} {{roll=[[1d20+@{rel_skill_bonus}]]}} {{mod=@{rel_skill_bonus}}}">Religion</button>
                    </div>
                </div>
            </div>
            <div class="sheet-stat">
                <div>
                    <button type="roll" name="roll_wis" value="&{template:stat} {{name=WISDOM}} {{roll=[[1d20+@{wis_mod}]]}} {{mod=@{wis_mod}}}">WISDOM</button>
                </div>
                <div class="scores-values">
                    <div class="modifier">
                        <input type="number" name="attr_wis_mod" value="@{wis_mod}" readonly>
                        <span>MODIFIER</span>
                    </div>
                    <div class="score">
                        <span>Score</span>
                        <input type="number" name="attr_wis" value="10" title="@{wis}" min="0">
                    </div>
                </div>
                <div class="skills">
                    <div>
                        <input type="checkbox" name="attr_wis_save" value="1">
                        <button type="roll" name="roll_wis_save" value="&{template:stat} {{name=Wisdom Save}} {{roll=[[1d20+@{wis_save_bonus}]]}} {{mod=@{wis_save_bonus}}}">SAVING THROW</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_ani_skill_prof" value="1">
                        <button type="roll" name="roll_skill_ani" value="&{template:stat} {{name=Animal Handling}} {{roll=[[1d20+@{ani_skill_bonus}]]}} {{mod=@{ani_skill_bonus}}}">Animal Handling</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_ins_skill_prof" value="1">
                        <button type="roll" name="roll_skill_ins" value="&{template:stat} {{name=Insight}} {{roll=[[1d20+@{ins_skill_bonus}]]}} {{mod=@{ins_skill_bonus}}}">Insight</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_med_skill_prof" value="1">
                        <button type="roll" name="roll_skill_med" value="&{template:stat} {{name=Medicine}} {{roll=[[1d20+@{med_skill_bonus}]]}} {{mod=@{med_skill_bonus}}}">Medicine</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_per_skill_prof" value="1">
                        <button type="roll" name="roll_skill_per" value="&{template:stat} {{name=Perception}} {{roll=[[1d20+@{per_skill_bonus}]]}} {{mod=@{per_skill_bonus}}}">Perception</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_sur_skill_prof" value="1">
                        <button type="roll" name="roll_skill_sur" value="&{template:stat} {{name=Survival}} {{roll=[[1d20+@{sur_skill_bonus}]]}} {{mod=@{sur_skill_bonus}}}">Survival</button>
                    </div>
                </div>
            </div>
            <div class="sheet-stat">
                <div>
                    <button type="roll" name="roll_cha" value="&{template:stat} {{name=CHARISMA}} {{roll=[[1d20+@{cha_mod}]]}} {{mod=@{cha_mod}}}">CHARISMA</button>
                </div>
                <div class="scores-values">
                    <div class="modifier">
                        <input type="number" name="attr_cha_mod" value="@{cha_mod}" readonly>
                        <span>MODIFIER</span>
                    </div>
                    <div class="score">
                        <span>Score</span>
                        <input type="number" name="attr_cha" value="10" title="@{cha}" min="0">
                    </div>
                </div>
                <div class="skills">
                    <div>
                        <input type="checkbox" name="attr_cha_save" value="1">
                        <button type="roll" name="roll_cha_save" value="&{template:stat} {{name=Charisma Save}} {{roll=[[1d20+@{cha_save_bonus}]]}} {{mod=@{cha_save_bonus}}}">SAVING THROW</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_dec_skill_prof" value="1">
                        <button type="roll" name="roll_skill_dec" value="&{template:stat} {{name=Deception}} {{roll=[[1d20+@{dec_skill_bonus}]]}} {{mod=@{dec_skill_bonus}}}">Deception</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_inti_skill_prof" value="1">
                        <button type="roll" name="roll_skill_inti" value="&{template:stat} {{name=Intimidation}} {{roll=[[1d20+@{inti_skill_bonus}]]}} {{mod=@{inti_skill_bonus}}}">Intimidation</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_perf_skill_prof" value="1">
                        <button type="roll" name="roll_skill_perf" value="&{template:stat} {{name=Performance}} {{roll=[[1d20+@{perf_skill_bonus}]]}} {{mod=@{perf_skill_bonus}}}">Performance</button>
                    </div>
                    <div>
                        <input type="checkbox" name="attr_pers_skill_prof" value="1">
                        <button type="roll" name="roll_skill_pers" value="&{template:stat} {{name=Persuasion}} {{roll=[[1d20+@{pers_skill_bonus}]]}} {{mod=@{pers_skill_bonus}}}">Persuasion</button>
                    </div>
                </div>
            </div>
            </div>
            <!-- COLUMN MIDDLE -->
            <div class="sheet-column-middle">
            <div class="sheet-character-core">
                <div class="core-column-left">
                    <div class="core-other-stat">
                        <span>PROFICIENCY</span>
                        <span>BONUS</span>
                        <input type="number" name="attr_proficiency" value="@{proficiency}" readonly>
                    </div>
                    <div class="core-other-stat">
                        <button type="roll" name="roll_initiative" value="&{template:stat} {{name=Initiative}} {{roll=[[1d20+@{dex_mod} &{tracker}]]}} {{mod=@{dex_mod}}}">Initiative</button>
                        <input type="number" name="attr_init_bonus" value="@{init_bonus}" readonly>
                    </div>
                    <div class="core-other-stat">
                        <span>LEVEL</span>
                        <input type="number" name="attr_level" value="1" min="1" max="30">
                    </div>
                    <div class="core-other-stat">
                        <span>XP</span>
                        <input type="number" name="attr_xp" value="null" readonly>
                    </div>
                    <div class="core-other-stat">
                        <span>INSPIRATION</span>
                        <input type="checkbox" name="inspiration">
                    </div>
                </div>
                <div class="core-column-middle">
                    <div class="core-avatar-image"></div>
                </div>
                <div class="core-column-right">
                   <div class="core-armor-class">
                        <span>ARMOR CLASS</span>
                        <input type="number" name="attr_armor_class" value="@{armor_class}" readonly>
                    </div>
                </div>
            </div>
            <div class="sheet-character-id">
                <div id="id-name">
                    <input type="text" name="attr_character_name" title="@{character_name}" value="@{character_name}">
                    <span>CHARACTER NAME</span>
                </div>
                <div id="id-background">
                    <input type="text" name="attr_background">
                    <span>BACKGROUND</span>
                </div>
                <div id="id-class">
                    <input type="text" name="attr_class">
                    <span>CLASS</span>
                </div>
                <div id="id-species">
                    <input type="text" name="attr_species">
                    <span>SPECIES</span>
                </div>
                <div id="id-subclass">
                    <input type="text" name="attr_subclass">
                    <span>SUBCLASS</span>
                </div>
                <div id="id-speed">
                    <div>
                        <input type="number" name="attr_speed" value="0">
                        <span>SPEED</span>
                    </div> 
                    <div>
                        <input type="number" name="attr_size" value="0">
                        <span>SIZE</span>
                    </div>
                </div>
            </div>
            <div class="sheet-character-damage">
                <span>WEAPONS, CANTRIPS & DAMAGE</span>
            </div>
            <div class="sheet-character-class-features">
                <span>CLASS FEATURES</span>
            </div>
            </div>
            <!-- COLUMN RIGHT -->
            <div class="sheet-column-right">
            <div class="sheet-character-dice">
                <span>HIT POINTS</span>
                <input type="number" name="attr_hp" value="0">
                <div id="hp-current">
                    <span>CURRENT</span>
                    <div>
                        <div>
                            <input type="number" name="attr_hp_temp" value="0">
                            <span>TEMP</span>
                        </div>
                        <div>
                            <input type="number" name="attr_hp_max" value="0">
                            <span>MAX</span>
                        </div>
                    </div>
                </div>
                <span>CONDITIONS</span>
                <input type="text" name="attr_condition">
            </div>
            <div class="sheet-character-dice">
                <span>HIT DICE</span>
                <div id="hit-dice">
                    <div>
                        <input type="number" name="attr_hit_dice_spent" value="0">
                        <span>SPENT</span>
                    </div>
                    <div>
                        <input type="number" name="attr_hit_dice" value="0">
                        <span>MAX</span>
                    </div>
                </div>
            </div>
            <div class="sheet-character-dice">
                <span>DEATH SAVES</span>
                <div id="death-save">
                    <div>
                        <div>
                            <input type="checkbox" name="death_successes_1" value="1">
                            <input type="checkbox" name="death_successes_2" value="1">
                            <input type="checkbox" name="death_successes_3" value="1">
                        </div>
                        <span>SUCCESSES</span>
                    </div>
                    <div>
                        <div>
                            <input type="checkbox" name="death_failures_1" value="1">
                            <input type="checkbox" name="death_failures_2" value="1">
                            <input type="checkbox" name="death_failures_3" value="1">
                        </div>
                        <span>FAILURES</span>
                    </div>
                </div>
            </div>
            <div class="sheet-character-speacies-traits">
                <span>SPECIES TRAITS</span>
            </div>
            <div class="sheet-character-backstory">
                <span>BACKSTORY AND PERSONALITY</span>
                <textarea name="attr_description" placeholder=""></textarea>
                <div>
                    <span>Aligment</span>
                    <input type="text" name="aligment">
                </div>
            </div>
            <div class="sheet-character-languages">
                <span>LANGUAGES</span>
            </div>
            </div>
        </div>
        
        <!-- character sheet // spells // page 2 -->

        <div class="sheet-toggle-character-spells">
            <span>spells</span>
        </div>

        <!-- character sheet // fate // page 3 -->

        <div class="sheet-toggle-character-fate">
            <span>fatewaving</span>
        </div>

    </div>

</div>

 
<!--roll tempalte -->

<rolltemplate class="sheet-rolltemplate-stat">
    <div class="sheet-template-container">
        <div class="sheet-results">
            <h4>{{roll}}</h4>
            <span>{{name}}{{#mod}} <span>({{mod}})</span>{{/mod}}</span>
        </div>
    </div>
</rolltemplate>

<!--at the bottom of the file-->

<input type="hidden" name="attr">

<script type="text/worker"> 

    let stats = ["str", "dex", "con", "int", "wis", "cha"];
    let skills = ["ath", "acr", "sle", "ste", "arc", "his", "inv", "nat", "rel", "ani", "ins", "med", "per", "sur", "dec", "inti", "perf", "pers"];

    stats.forEach(stat => {
        on(`change:${stat} sheet:opened`,() => {
            getAttrs([stat], values => {
                const stat_score = parseInt(values[stat])||0;
                const stat_modifier = Math.floor(stat_score/2) -5;
                setAttrs({
                    [`${stat}_mod`]: stat_modifier
                });
            });
        });
    });

    stats.forEach(stat => {
        on(`change:${stat}_save change:${stat}_mod change:proficiency sheet:opened`,()=> {
            getAttrs([stat +"_mod",stat+"_save","proficiency"], values => {
                const stat_mod = parseInt(values[stat +"_mod"])||0;
                const stat_save = parseInt(values[stat+"_save"])||0;
                const prof = parseInt(values["proficiency"])||0;
                const stat_save_bonus = stat_mod+(stat_save*prof);
                setAttrs({
                    [`${stat}_save_bonus`]: stat_save_bonus
                });
            });
        });
    });
    

    skills.forEach(skill => {
        on(`change:${skill}_skill_prof change:str_mod change:dex_mod change:int_mod change:wis_mod change:cha_mod change:proficiency sheet:opened`,() => {
            getAttrs([skill+"_skill_prof", "proficiency", "str_mod", "dex_mod", "int_mod","wis_mod","cha_mod"], values => {

                const skill_prof = parseInt(values[skill+"_skill_prof"])||0;
                const prof = parseInt(values["proficiency"])||2;
                const str_mod = parseInt(values["str_mod"])||0;
                const dex_mod = parseInt(values["dex_mod"])||0;
                const int_mod = parseInt(values["int_mod"])||0;
                const wis_mod = parseInt(values["wis_mod"])||0;
                const cha_mod = parseInt(values["cha_mod"])||0;


                switch (skill){
                    case "ath":
                        const skill_bonus_str = str_mod+(skill_prof*prof);
                        setAttrs({[`${skill}_skill_bonus`]:  skill_bonus_str });
                        break;
                    case "acr":
                    case "sle":
                    case "ste":
                        const skill_bonus_dex = dex_mod+(skill_prof*prof);
                        setAttrs({[`${skill}_skill_bonus`]:  skill_bonus_dex });
                        break;
                    case "arc":
                    case "his":
                    case "inv":
                    case "nat":
                    case "rel":
                        const skill_bonus_int = int_mod+(skill_prof*prof);
                        setAttrs({[`${skill}_skill_bonus`]:  skill_bonus_int });
                        break;
                    case "ani":
                    case "ins":
                    case "med":
                    case "per":
                    case "sur":
                        const skill_bonus_wis = wis_mod+(skill_prof*prof);
                        setAttrs({[`${skill}_skill_bonus`]:  skill_bonus_wis });
                        break;
                    case "dec":
                    case "inti":
                    case "perf":
                    case "pers":
                        const skill_bonus_cha = cha_mod+(skill_prof*prof);
                        setAttrs({[`${skill}_skill_bonus`]:  skill_bonus_cha });
                        break;
                }
            });
        });
    });


    on(`change:level sheet:opened`, function(){
        getAttrs(["level"],function(values) {
            if(values.level<=4){
                setAttrs({ proficiency:2 });
            }
            else if(values.level<=8){
                setAttrs({ proficiency:3 });
            }
            else if(values.level<=12){
                setAttrs({ proficiency:4 });
            }
            else if(values.level<=16){
                setAttrs({ proficiency:5 });
            }
            else if(values.level<=20){
                setAttrs({ proficiency:6 });
            };
        });
    });

    

</script>
