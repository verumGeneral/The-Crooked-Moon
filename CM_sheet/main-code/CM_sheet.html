<div id="sheet-crooked-moon">
  <!--[HIDDEN]-->

  <input type="checkbox" id="block_switch_1" class="sheet-block-switch" name="attr_block_switch" value="1">
  <!--[PC-SHEET-MAIN]-->
  <div class="sheet-block-pc">
    <!--[PC-tab-toggle]--> 
    <input type="hidden" class="sheet-tabtoggle" name="attr_sheetTab" value="core">
    <div id="main-button">
        <button type="action" name="act_core" class="sheet-button0">[CORE]</button>
        <button type="action" name="act_spells" class="sheet-button1">[SPELLS/EQ]</button>
        <button type="action" name="act_fate" class="sheet-button2">[FATE]</button>
        <button type="action" name="act_options" class="sheet-button3">[OPTIONS]</button>
    </div>
      <!--[CORE]-->
    <div class="sheet-core">
        <!--[ABILITY]-->
        <div class="ability-main">
          <!--[STR]-->
          <div class="ability-data">
            <button>STRENGTH</button>
            <div class="ability-stat">
              <div class="ability-mod">
                <input type="number" name="attr_str_mod" value="@{str_mod}">
                <span>MODIFIER</span>
              </div>
              <div class="ability-score">
                <span>Score</span>
                <input type="number" name="attr_str" value="@{str}">
              </div>
            </div>
            <div class="ability-input">
              <input type="checkbox" name="attr_str_save" value="1">
              <input type="hidden" name="attr_str_save_bonus" value="@{str_save_bonus}">
              <button>SAVING THROW</button>
              <input type="checkbox" name="attr_athl" value="1">
              <input type="hidden" name="attr_athl_bonus" value="@{athl_bonus}">
              <button>Athletics</button>
            </div>
          </div>
          <!--[DEX]-->
          <div class="ability-data">
            <button>DEXTERITY</button>
            <div class="ability-stat">
              <div class="ability-mod">
                <input type="number" name="attr_dex_mod" value="@{dex_mod}" readonly>
                <span>MODIFIER</span>
              </div>
              <div class="ability-score">
                <span>Score</span>
                <input type="number" name="attr_dex" value="@{dex}">
              </div>
            </div>
            <div class="ability-input">
              <input type="checkbox" name="attr_dex_save" value="1">
              <input type="hidden" name="attr_dex_save_bonus" value="@{dex_save_bonus}">
              <button>SAVING THROW</button>
              <input type="checkbox" name="attr_acro" value="1">
              <input type="hidden" name="attr_acro_bonus" value="@{acro_bonus}">
              <button>Acrobatics</button>
              <input type="checkbox" name="attr_slei" value="1">
              <input type="hidden" name="attr_slei_bonus" value="@{slei_bonus}">
              <button>Sleight of Hand</button>
              <input type="checkbox" name="attr_stea" value="1">
              <input type="hidden" name="attr_stea_bonus" value="@{stea_bonus}">
              <button>Stealth</button>
            </div>
          </div>
          <!--[CON]-->
          <div class="ability-data">
            <button>CONSTITUTION</button>
            <div class="ability-stat">
              <div class="ability-mod">
                <input type="number" name="attr_con_mod" value="@{con_mod}" readonly>
                <span>MODIFIER</span>
              </div>
              <div class="ability-score">
                <span>Score</span>
                <input type="number" name="attr_con" value="@{con}">
              </div>
            </div>
            <div class="ability-input">
              <input type="checkbox" name="attr_con_save" value="1">
              <input type="hidden" name="attr_con_save_bonus" value="@{con_save_bonus}">
              <button>SAVING THROW</button>
            </div>
          </div>
          <!--[INT]-->
          <div class="ability-data">
            <button>INTELLIGENCE</button>
            <div class="ability-stat">
              <div class="ability-mod">
                <input type="number" name="attr_int_mod" value="@{int_mod}" readonly>
                <span>MODIFIER</span>
              </div>
              <div class="ability-score">
                <span>Score</span>
                <input type="number" name="attr_int" value="@{int}">
              </div>
            </div>
            <div class="ability-input">
              <input type="checkbox" name="attr_int_save" value="1">
              <input type="hidden" name="attr_int_save_bonus" value="@{int_save_bonus}">
              <button>SAVING THROW</button>
              <input type="checkbox" name="attr_arca" value="1">
              <input type="hidden" name="attr_arca_bonus" value="@{arca_bonus}">
              <button>Arcana</button>
              <input type="checkbox" name="attr_hist" value="1">
              <input type="hidden" name="attr_hist_bonus" value="@{hist_bonus}">
              <button>History</button>
              <input type="checkbox" name="attr_inve" value="1">
              <input type="hidden" name="attr_inve_bonus" value="@{inve_bonus}">
              <button>Investigation</button>
              <input type="checkbox" name="attr_natu" value="1">
              <input type="hidden" name="attr_natu_bonus" value="@{natu_bonus}">
              <button>Nature</button>
              <input type="checkbox" name="attr_reli" value="1">
              <input type="hidden" name="attr_reli_bonus" value="@{reli_bonus}">
              <button>Religion</button>
            </div>
          </div>
          <!--[WIS]-->
          <div class="ability-data">
            <button>WISDOM</button>
            <div class="ability-stat">
              <div class="ability-mod">
                <input type="number" name="attr_wis_mod" value="@{wis_mod}" readonly>
                <span>MODIFIER</span>
              </div>
              <div class="ability-score">
                <span>Score</span>
                <input type="number" name="attr_wis" value="@{wis}">
              </div>
            </div>
            <div class="ability-input">
              <input type="checkbox" name="attr_wis_save" value="1">
              <input type="hidden" name="attr_wis_save_bonus" value="@{wis_save_bonus}">
              <button>SAVING THROW</button>
              <input type="checkbox" name="attr_anim" value="1">
              <input type="hidden" name="attr_anim_bonus" value="@{anim_bonus}">
              <button>Animal Handling</button>
              <input type="checkbox" name="attr_insi" value="1">
              <input type="hidden" name="attr_insi_bonus" value="@{insi_bonus}">
              <button>Insight</button>
              <input type="checkbox" name="attr_medi" value="1">
              <input type="hidden" name="attr_medi_bonus" value="@{medi_bonus}">
              <button>Medicine</button>
              <input type="checkbox" name="attr_perc" value="1">
              <input type="hidden" name="attr_perc_bonus" value="@{perc_bonus}">
              <button>Perception</button>
              <input type="checkbox" name="attr_surv" value="1">
              <input type="hidden" name="attr_surv_bonus" value="@{surv_bonus}">
              <button>Survival</button>
              <div class="ability-passive">
                <input type="number" name="attr_pass_bonus" value="@{pass_bonus}" readonly>
                <span>Passive</span>
              </div>
            </div>
          </div>
          <!--[CHA]-->
          <div class="ability-data">
            <button>CHARISMA</button>
            <div class="ability-stat">
              <div class="ability-mod">
                <input type="number" name="attr_cha_mod" value="@{cha_mod}" readonly>
                <span>MODIFIER</span>
              </div>
              <div class="ability-score">
                <span>Score</span>
                <input type="number" name="attr_cha" value="@{int}">
              </div>
            </div>
            <div class="ability-input">
              <input type="checkbox" name="attr_cha_save" value="1">
              <input type="hidden" name="attr_cha_save_bonus" value="@{cha_save_bonus}">
              <button>SAVING THROW</button>
              <input type="checkbox" name="attr_dece" value="1">
              <input type="hidden" name="attr_dece_bonus" value="@{dece_bonus}">
              <button>Deception</button>
              <input type="checkbox" name="attr_inti" value="1">
              <input type="hidden" name="attr_inti_bonus" value="@{inti_bonus}">
              <button>Intimidation</button>
              <input type="checkbox" name="attr_perf" value="1">
              <input type="hidden" name="attr_perf_bonus" value="@{perf_bonus}">
              <button>Performance</button>
              <input type="checkbox" name="attr_pers" value="1">
              <input type="hidden" name="attr_pers_bonus" value="@{pers_bonus}">
              <button>Persuasion</button>
            </div>
          </div>
        </div>
        <!--[STATS / PORTRAIT]-->
        <div class="stats-main">
          <div class="stats-left">
            <div class="stat">
              <span>PROFICIENCY BONUS</span>
              <input type="number" name="attr_prof_bonus" value="@{prof_bonus}" readonly>
            </div>
            <div class="stat">
              <button>INITIATIVE</button>
              <input type="number" name="attr_initiative" value="@{initiative}" readonly>
            </div>
            <div class="stat">
              <input type="number" name="attr_level" value="@{level}">
              <span>LEVEL</span>
            </div>
            <div class="stat">
              <input type="number" name="attr_xp" value="@{xp}">
              <span>XP</span>
            </div>
            <div class="stat">
              <span>INSPIRATION</span>
              <input type="checkbox" name="attr_inspiration" value="1">
            </div>
          </div>
          <div class="stats-jpg"></div>
          <div class="stats-right">
            <div class="stat">
              <span>ARMOR CLASS</span>
              <input type="number" name="attr_ac" value="@{ac}">
            </div>
          </div>
        </div>
        <!--[CHARACTER INFO]-->
        <div class="char-info-main">
          <div class="char-info">
            <div class="char-name">
              <input type="text" name="attr_char_name" value="@{char_name}" placeholder="...">
              <span>CHARACTER NAME</span>
            </div>
            <div class="char-back">
              <input type="text" name="attr_background" list="back">
              <datalist name="attr_background" id="back">
                <option value="Amnesiac">Amnesiac</option>
                <option value="Crimson Aspirant">Crimson Aspirant</option>
                <option value="Crossroads Gambler">Crossroads Gambler</option>
                <option value="Cultist">Cultist</option>
                <option value="Druskenvald Dweller">Druskenvald Dweller</option>
                <option value="Experiment">Experiment</option>
                <option value="Ghostlight Passenger">Ghostlight Passenger</option>
                <option value="Night Stalker">Night Stalker</option>
                <option value="Reflected Wanderer">Reflected Wanderer</option>
                <option value="Rest Warden">Rest Warden</option>
                <option value="Reveler">Reveler</option>
                <option value="Scholar of The Forbidden">Scholar of The Forbidden</option>
                <option value="Wicker Weaver">Wicker Weaver</option>
              </datalist>
              <span>BACKGROUND</span>
            </div>
            <div class="char-class">
              <input type="text" name="attr_class" list="class">
              <datalist name="attr_class" id="class">
                <option value="Barbarian">Barbarian</option>
                <option value="Bard">Bard</option>
                <option value="Cleric">Cleric</option>
                <option value="Druid">Druid</option>
                <option value="Fighter">Fighter</option>
                <option value="Monk">Monk</option>
                <option value="Paladin">Paladin</option>
                <option value="Ranger">Ranger</option>
                <option value="Rogue">Rogue</option>
                <option value="Sorcerer">Sorcerer</option>
                <option value="Warlock">Warlock</option>
                <option value="Wizard">Wizard</option>
              </datalist>
              <span>CLASS</span>
            </div>
            <div class="char-species">
              <input type="text" name="attr_species" list="species">
              <datalist name="attr_species" id="species">
                <option value="Ashborn">Ashborn</option>
                <option value="Azureborn">Azureborn</option>
                <option value="Bogborn">Bogborn</option>
                <option value="Curseborn">Curseborn</option>
                <option value="Deepborn">Deepborn</option>
                <option value="Gnarlborn">Gnarlborn</option>
                <option value="Graveborn">Graveborn</option>
                <option value="Harvestborn">Harvestborn</option>
                <option value="Plagueborn">Plagueborn</option>
                <option value="Relicborn">Relicborn</option>
                <option value="Silkborn">Silkborn</option>
                <option value="Stoneborn">Stoneborn</option>
                <option value="Threadborn">Threadborn</option>
              </datalist>
              <span>SPECIES</span>
            </div>
            <div class="char-subclass">
              <input type="text" name="attr_subclass">
              <span>SUBCLASS</span>
            </div>
          </div>
          <div class="other-stat">
            <div class="stat">
              <input type="number" name="attr_speed" min="0">
              <span>SPEED</span>
            </div>
            <div class="stat">
              <input type="text" name="attr_size">
              <span>SIZE</span>
            </div>
          </div>
        </div>
        <!--[ATTACKS]-->
        <div class="attack-main">
          <span>WEAPONS, CANTRIPS & DAMAGE</span>
          <div class="header">
            <span>Name</span>
            <span>Atk Bonus/DC</span>
            <span>Damage & Type</span>
            <span>Notes</span>
          </div>
          <fieldset class="repeating_attack">
            <input type="checkbox" class="repeat-block-switch" name="attr_feat_block_switch" value="1">
            <!--row-mod-->
            <div class="row-raw">
              <span>NAME:</span>
              <input type="text" name="attr_name">
              <br>
              <input type="checkbox" name="attr_is_attack" value="1">
              <span>ATTACK:</span>
              <select name="attr_attack_bonus">
                <option value="0">--</option>
                <option value="spe">SPELL</option>
                <option value="str">STR</option>
                <option value="dex">DEX</option>
                <option value="con">CON</option>
                <option value="int">INT</option>
                <option value="wis">WIS</option>
                <option value="cha">CHA</option>
              </select>
              <span>+</span>
              <input type="number" name="attr_optional_attack_mod" min="0">
              <span>+</span>
              <input type="checkbox" name="attr_is_prof" value="1">
              <span>PROFICIENT</span>
              <span>RANGE:</span>
              <input type="text" name="range" placeholder="Self(60ft-cone)">
              <span>MAGIC BONUS:</span>
              <input type="number" name="attr_magic_bonus" min="0">
              <span>CRIT RANGE:</span>
              <input type="number" name="attr_crit_range" min="1" max="20">
              <br>
              <input type="checkbox" name="attr_is_damage_1" value="1">
              <span>DAMAGE:</span>
              <input type="text" name="attr_damage_dice_1" placeholder="1d6">
              <span>+</span>
               <select name="attr_damage_bonus_1">
                <option value="">--</option>
                <option value="spe">SPELL</option>
                <option value="str">STR</option>
                <option value="dex">DEX</option>
                <option value="con">CON</option>
                <option value="int">INT</option>
                <option value="wis">WIS</option>
                <option value="cha">CHA</option>
              </select>
              <span>+</span>
              <input type="number" name="attr_optional_damage_mod_1" min="0">
              <span>TYPE:</span>
              <input type="text" name="attr_damage_type_1" placeholder="Slashing">
              <span>CRIT:</span>
              <input type="text" name="attr_crit_dice_1" placeholder="1d6">
              <br>
              <input type="checkbox" name="attr_is_damage_2" value="1">
              <span>DAMAGE2:</span>
              <input type="text" name="attr_damage_dice_2" placeholder="1d6">
              <span>+</span>
               <select name="attr_damage_bonus_2">
                <option value="">--</option>
                <option value="spe">SPELL</option>
                <option value="str">STR</option>
                <option value="dex">DEX</option>
                <option value="con">CON</option>
                <option value="int">INT</option>
                <option value="wis">WIS</option>
                <option value="cha">CHA</option>
              </select>
              <span>+</span>
              <input type="number" name="attr_optional_damage_mod_2" min="0">
              <span>TYPE:</span>
              <input type="text" name="attr_damage_type_2" placeholder="Slashing">
              <span>CRIT:</span>
              <input type="text" name="attr_crit_dice_2" placeholder="1d6">
              <br>
              <input type="checkbox" name="attr_is_save" value="1">
              <span>SAVING THROW:</span>
              <select name="attr_attack_save">
                <option value="Strength">STR</option>
                <option value="Dexterity">DEX</option>
                <option value="Constitution">CON</option>
                <option value="Inteligence">INT</option>
                <option value="Wisdom">WIS</option>
                <option value="Charisma">CHA</option>
              </select>
              <span>VS DC:</span> <!--dla atrybutów 10 + mod-->
              <select name="attr_attack_save_stat">
                <option value="spe">SPELL</option>
                <option value="str">STR</option>
                <option value="dex">DEX</option>
                <option value="con">CON</option>
                <option value="int">INT</option>
                <option value="wis">WIS</option>
                <option value="cha">CHA</option>
              </select>
              <span>SAVE EFFECT:</span>
              <input type="text" name="attr_save_effect" placeholder="half damage">
              <span>NOTES:</span>
              <textarea name="attr_notes" placeholder="..."></textarea>
            </div>
            <!--row-clean-->
            <div class="row-clean">
              <input type="button" name="attr_name" readonly>
              <input type="text" name="attr_atk_bonus" readonly>
              <input type="button" name="attr_atk_damage" readonly>
              <input name="attr_notes" readonly>
              <!--dodać do tego hidden attr-->
              
            </div>
          </fieldset>
        </div>
        <!--[FEATURES]-->
        <div class="features-main">
          <span>CLASS FEATURES</span>
          <fieldset class="repeating_feature">
            <input type="checkbox" class="repeat-block-switch" name="attr_feat_block_switch" value="1">
               <!--row-mod-->
              <div class="row-raw">
                <span>NAME:</span>
                <input type="text" name="attr_name" placeholder="...">
                <span>SOURCE TYPE:</span>
                <input type="text" name="attr_source_type" placeholder="...">
                <textarea name="attr_text" placeholder="..."></textarea>
              </div>
              <!--row-clean-->
              <div class="row-clean">
                <input type="text" name="attr_name">
                <button type="roll" name="roll_feat" value="[placeholder_macro]">chat</button>
                <input type="text" name="attr_source_type" readonly>
                <input type="checkbox" class="feat-row-hide"> <!--zrobić to niewidoczne dla nazwy-->
                <div class="feat-row-hide-text">
                  <input type="text" name="attr_text" readonly>
                </div>
              </div>
          </fieldset>
        </div>
        <!--[HIT POINTS]-->
        <div class="hit-points-main">
          <div class="hp">
            <span>HIT POINTS</span>
            <input type="number" name="attr_hp" value="@{hp}">
          </div>
          <div class="hp_current">
            <div class="hp-temp">
              <input type="number" name="attr_hp_temp" value="@{hp_temp}" min="0">
              <span>TEMP</span>
            </div>
            <div class="hp-max">
              <input type="number" name="attr_hp_max" value="@{hp_max}" min="0">
              <span>MAX</span>
            </div>
            <div class="hp-condition">
              <span>CONDITIONS</span>
              <input type="text" name="attr_hp_cond" placeholder="...">
            </div>
          </div>
        </div>
        <!--[HIT DICE]-->
        <div class="hit-dice-main">
          <button>HIT DICE</button>
          <div class="hd-spent">
            <input type="number" name="attr_hd" min="0">
            <span>SPENT</span>
          </div>
          <div class="hd-max">
            <input type="number" name="attr_hd_max" min="0" readonly>
            <span>MAX</span>
          </div>
        </div>
        <!--[STRESS]-->
        <div class="stress-main">
          <button>STRESS</button>
          <div class="stress">
            <input type="number" name="attr_stress" min="0">
            <span>CURRENT</span>
          </div>
          <div class="stress-max">
            <input type="number" name="attr_stress_max" min="0">
            <span>MAX</span>
          </div>
          <div class="stress-treshold">
            <span>TRESHOLDS</span>
            <div class="stress-treshold-block">
              <span>AFFLICTION:</span>
              <input type="number" name="attr_stress_treshold" min="0" readonly>
            </div>
            <div class="stress-treshold-block">
              <span>DEATH DOOR:</span>
              <input type="number" name="attr_stress_door" min="0" readonly>
            </div>
          </div>
        </div>
        <!--[DEATH SAVES]-->
        <div class="death-saves-main">
          <button>DEATH SAVES</button>
          <div class="ds-success">
            <input type="checkbox">
            <input type="checkbox">
            <input type="checkbox">
            <span>SUCCESSES</span>
          </div>
          <div class="ds-failure">
            <input type="checkbox">
            <input type="checkbox">
            <input type="checkbox">
            <span>FAILURES</span>
          </div>
        </div>
        <!--[SPECIES TRAITS]-->
        <div class="traits-main">
          <span>SPECIES TRAITS</span>
          <fieldset class="repeating_traits">
            <input type="checkbox" class="repeat-block-switch" name="attr_feat_block_switch" value="1">
               <!--row-mod-->
              <div class="row-raw">
                <span>NAME:</span>
                <input type="text" name="attr_name" placeholder="...">
                <span>SOURCE TYPE:</span>
                <input type="text" name="attr_source_type" placeholder="...">
                <textarea name="attr_text" placeholder="..."></textarea>
              </div>
              <!--row-clean-->
              <div class="row-clean">
                <input type="text" name="attr_name">
                <button type="roll" name="roll_feat" value="[placeholder_macro]">chat</button>
                <input type="text" name="attr_source_type" readonly>
                <input type="checkbox" class="feat-row-hide"> <!--zrobić to niewidoczne dla nazwy-->
                <div class="feat-row-hide-text">
                  <input type="text" name="attr_text" readonly>
                </div>
              </div>
          </fieldset>
        </div>
        <!--[BACKSTORY & PERSONALITY]-->
        <div class="backstory-main">
          <span>BACKSTRORY & PERSONALITY</span>
          <textarea name="attr_backstory" placeholder="..."></textarea>
          <div class="backstory-personality">
            <span>Alignment:</span>
            <input type="text" name="attr_alignment">
          </div>
        </div>
        <!--[LANGUAGES]-->
        <div class="languages-main">
          <button>LANGUAGES</button>
          <textarea name="attr_languages" placeholder="Common"></textarea>
        </div>
      </div>
      <!--[SPELLS/EQ]-->
    <div class="sheet-spells">
        <!--[SPELLCASTING]-->
        <div class="spellcasting-main">
          <div class="spell-ability">
            <span>SPELCASTING ABILITY</span>
            <div id="spell-ability">
              <input type="radio" name="attr_spell_ability" value="1" readonly>
              <span>Inteligence</span>
            </div>
            <div id="spell-ability">
              <input type="radio" name="attr_spell_ability" value="2" readonly>
              <span>Wisdom</span>
            </div>
            <div id="spell-ability">
              <input type="radio" name="attr_spell_ability" value="3" readonly>
              <span>Charisma</span>
            </div>
         </div>
          <div id="spell-stats">
            <div id="spell_mod">
              <span>SPELLCASTING MODIFIER</span>
              <input type="number" name="attr_spell_mod" value="@{spell_mod}" readonly>
            </div>
            <div id="spell_save">
              <span>SPELL SAVE DC</span>
              <input type="number" name="attr_spell_save" value="@{spell_save}" readonly>
            </div>
            <div id="spell_attack_bonus">
              <span>SPELL ATTACK BONUS</span>
              <input type="number" name="attr_spell_attack_bonus" value="@{spell_attack_bonus}" readonly>
            </div>
          </div>
        </div>
        <!--[SPELL SLOTS]-->
        <div class="spell-slots-main">
          <span>SPELL SLOTS</span>
          <div id="level-1-3">
            <span>Total</span>
            <span>Expended</span>
            <div id="level-1">
              <span>Level 1</span>
              <input type="number" name="attr_spell_lvl_1_total" value="@{spell_lvl_1_total}" readonly>
              <input type="number" name="attr_spell_lvl_1_exp" value="@{spell_lvl_1_exp}" min="0">
            </div>
            <div id="level-2">
              <span>Level 2</span>
              <input type="number" name="attr_spell_lvl_2_total" value="@{spell_lvl_2_total}" readonly>
              <input type="number" name="attr_spell_lvl_2_exp" value="@{spell_lvl_2_exp}" min="0">
            </div>
            <div id="level-3">
              <span>Level 3</span>
              <input type="number" name="attr_spell_lvl_3_total" value="@{spell_lvl_3_total}" readonly>
              <input type="number" name="attr_spell_lvl_3_exp" value="@{spell_lvl_3_exp}" min="0">
            </div>
          </div>
          <div id="level-4-6">
            <span>Total</span>
            <span>Expended</span>
            <div id="level-4">
              <span>Level 4</span>
              <input type="number" name="attr_spell_lvl_4_total" value="@{spell_lvl_4_total}" readonly>
              <input type="number" name="attr_spell_lvl_4_exp" value="@{spell_lvl_4_exp}" min="0">
            </div>
            <div id="level-5">
              <span>Level 5</span>
              <input type="number" name="attr_spell_lvl_5_total" value="@{spell_lvl_5_total}" readonly>
              <input type="number" name="attr_spell_lvl_5_exp" value="@{spell_lvl_5_exp}" min="0">
            </div>
            <div id="level-6">
              <span>Level 6</span>
              <input type="number" name="attr_spell_lvl_6_total" value="@{spell_lvl_6_total}" readonly>
              <input type="number" name="attr_spell_lvl_6_exp" value="@{spell_lvl_6_exp}" min="0">
            </div>
          </div>
          <div id="level-7-9">
            <span>Total</span>
            <span>Expended</span>
            <div id="level-7">
              <span>Level 7</span>
              <input type="number" name="attr_spell_lvl_7_total" value="@{spell_lvl_7_total}" readonly>
              <input type="number" name="attr_spell_lvl_7_exp" value="@{spell_lvl_7_exp}" min="0">
            </div>
            <div id="level-8">
              <span>Level 8</span>
              <input type="number" name="attr_spell_lvl_8_total" value="@{spell_lvl_8_total}" readonly>
              <input type="number" name="attr_spell_lvl_8_exp" value="@{spell_lvl_8_exp}" min="0">
            </div>
            <div id="level-9">
              <span>Level 9</span>
              <input type="number" name="attr_spell_lvl_9_total" value="@{spell_lvl_9_total}" readonly>
              <input type="number" name="attr_spell_lvl_9_exp" value="@{spell_lvl_9_exp}" min="0">
            </div>
          </div>
        </div>
        <!--[FEATS]-->
        <div class="feats-main">
          <span>FEATS</span>
            <fieldset class="repeating_feats">
              <input type="checkbox" class="repeat-block-switch" name="attr_feat_block_switch" value="1">
               <!--row-mod-->
              <div class="row-raw">
                <span>NAME:</span>
                <input type="text" name="attr_name" placeholder="...">
                <span>SOURCE:</span>
                <select name="attr_source">
                  <option value="choose">Choose</option>
                  <option value="background">Background</option>
                  <option value="item">Item</option>
                  <option value="other">Other</option>
                </select>
                <span>SOURCE TYPE:</span>
                <input type="text" name="attr_source_type" placeholder="...">
                <textarea name="attr_text" placeholder="..."></textarea>
              </div>
              <!--row-clean-->
              <div class="row-clean">
                <input type="text" name="attr_name">
                <button type="roll" name="roll_feat" value="[placeholder_macro]">chat</button>
                <input type="text" name="attr_source" readonly>
                <input type="text" name="attr_source_type" readonly>
                <input type="checkbox" class="feat-row-hide"> <!--zrobić to niewidoczne dla nazwy-->
                <div class="feat-row-hide-text">
                  <input type="text" name="attr_text" readonly>
                </div>
              </div>
            </fieldset>
        </div>
        <!--[COINS]-->
        <div class="coin-main">
          <div id="coin-cp">
            <span>CP</span>
            <input type="number" name="attr_coin_cp" value="@{coin_cp}" min="0">
          </div>
          <div id="coin-sp">
            <span>SP</span>
            <input type="number" name="attr_coin_sp" value="@{coin_sp}" min="0">
          </div>
          <div id="coin-ep">
            <span>EP</span>
            <input type="number" name="attr_coin_ep" value="@{coin_ep}" min="0">
          </div>
          <div id="coin-gp">
            <span>GP</span>
            <input type="number" name="attr_coin_gp" value="@{coin_gp}" min="0">
          </div>
          <div id="coin-pp">
            <span>PP</span>
            <input type="number" name="attr_coin_pp" value="@{coin_pp}" min="0">
          </div>
        </div>
        <!--[SPELLS]-->
        <div class="spells-main">
          <span>CANTRIPS & PREPARED SPELLS</span>
           <fieldset class="repeating_spells">
            <input type="checkbox" class="repeat-block-switch" name="attr_spell_block_switch" value="1">
            <!--row-mod-->
            <div class="row-raw">
              <span>Level:</span>
              <input type="number" name="attr_spell_level" min="0">
              <span>Name:</span>
              <input type="text" name="attr_name">
              <span>Casting Time:</span>
              <input type="text" name="attr_cast_time">
              <span>Range:</span>
              <input type="text" name="attr_range">
              <span>Concentration:</span>
              <input type="checkbox" name="attr_concentration" value="1" class="check">
              <span>Ritual:</span>
              <input type="checkbox" name="attr_ritual" value="1" class="check">
              <span>Material:</span>
              <input type="text" name="attr_material" placeholder="...">
              <span>Notes:</span>
              <textarea name="attr_text" placeholder="..."></textarea>
            </div>
            <!--row-clean-->
            <div class="row-clean">
              <input type="number" name="attr_spell_level" readonly>
              <input type="button" name="attr_name" value="[placeholder_macro]">
              <input type="text" name="attr_cast_time" readonly>
              <input type="text" name="attr_range" readonly>
              <input type="number" name="attr_concentration" readonly>
              <input type="number" name="attr_ritual" readonly>
              <div class="sheet-tooltip">
                <span>!</span>
                <div>
                  <input type="text" name="attr_material" readonly>
                </div>
              </div>
              <input type="text" name="attr_text" readonly>
            </div>
           </fieldset>
        </div>
        <!--[EQ PROF]-->
        <div class="prof-main">
          <span>EQUIPMENT TRAINING & PROFICIENCY</span>
           <!--[WEAPON]-->
          <div class="weapons-main">
            <div class="weapons-title">
              <hr>
              <button type="roll" name="roll_weapon" value="@{weapon_prof}">WEAPONS</button> <!--template i wgl-->
            </div>
            <textarea name="attr_weapon_prof" placeholder="Simple"></textarea>
          </div>
           <!--[TOOLS]-->
          <div class="tools-main">
            <div class="tools-title">
              <hr>
              <span>TOOLS</span> <!--template i wgl-->
            </div>
            <fieldset class="repeating_tools">
              <input type="checkbox" class="repeat-block-switch" name="attr_spell_block_switch" value="1">
              <!--row-mod-->
              <div class="row-raw">
                <span>Name:</span>
                <input type="text" name="attr_name" placeholder="Doctor's Tools">
                <span>Proficiency bonus:</span>
                <select name="attr_bonus">
                  <option value="-1">--</option>
                  <option value="0">PROFICIENT</option>
                  <option value="1">EXPERTISE</option>
                  <option value="2">JACK</option>
                </select>
                <span>Ability:</span>
                <select name="attr_ability">
                  <option value="0">--</option>
                  <option value="str">STR</option>
                  <option value="dex">DEX</option>
                  <option value="con">CON</option>
                  <option value="int">INT</option>
                  <option value="wis">WIS</option>
                  <option value="cha">CHA</option>
                </select>
                <span>Mods:</span>
                <input type="number" name="attr_mod">
              </div>
              <!--row-clean-->
              <div class="row-clean">
                <input type="button" name="attr_name">
                <input type="number" name="attr_full_bonus">
                <input type="text" name="attr_ability">
              </div>
            </fieldset>
          </div>
           <!--[ARMOR]-->
          <div class="armor-main">
            <div>
              <hr>
              <button type="roll" name="roll_armor" value="@{armor_prof}">ARMOR</button> <hr><!--template i wgl-->
            </div>
            <span>Light</span>
            <input type="checkbox" id="prof_armor_light" name="attr_armor_light" value="Light">
            <span>Medium</span>
            <input type="checkbox" id="prof_armor_medium" name="attr_armor_medium" value="Medium">
            <span>Heavy</span>
            <input type="checkbox" id="prof_armor_heavy" name="attr_armor_heavy" value="Heavy">
            <span>Shields</span>
            <input type="checkbox" id="prof_armor_shield" name="attr_armor_shield" value="Shields">
          </div>
          <hr>
        </div>
        <!--[EQ]-->
        <div class="eq-main">
          <span>EQUIPMENT</span>
          <div class="eq-button">
            <button type="action" name="act_eq_null" >[ALL]</button>
            <input type="hidden" name="attr_eq_null" value="-1">
            <button type="action" name="act_eq_weapon">[W]</button>
            <input type="hidden" name="attr_eq_weapon" value="0">
            <button type="action" name="act_eq_armor">[A]</button>
            <input type="hidden" name="attr_eq_armor" value="1">
            <button type="action" name="act_eq_magic">[M]</button>
            <input type="hidden" name="attr_eq_magic" value="2">
            <button type="action" name="act_eq_food">[F]</button>
            <input type="hidden" name="attr_eq_food" value="3">
            <button type="action" name="act_eq_components">[C]</button>
            <input type="hidden" name="attr_eq_components" value="4">
            <button type="action" name="act_eq_remedy">[R]</button>
            <input type="hidden" name="attr_eq_remedy" value="5">
            <button type="action" name="act_eq_other">[O]</button>
            <input type="hidden" name="attr_eq_other" value="6">
          </div>
          <fieldset class="repeating_eq">
            <!--display-filter-->
            <input type="hidden" class="toggle-show" name="attr_show" value="1">
            <div class="eq-display">
              <input type="checkbox" class="repeat-block-switch" name="attr_feat_block_switch" value="1">
              <!--row-mod-->
              <div class="row-raw"> 
                <input type="number" name="attr_number" min="0">
                <select name="attr_eq_type">
                  <option value="-1">--</option>
                  <option value="0">weapon</option>
                  <option value="1">armor</option>
                  <option value="2">magic item</option>
                  <option value="3">food</option>
                  <option value="4">componends</option>
                  <option value="5">remedy</option>
                  <option value="6">other</option>
                </select>
                <input type="text" name="attr_name" placeholder="dagger"> 
                <input type="text" name="attr_text" placeholder="notes">
              </div>
              <!--row-mod-->
              <div class="row-clean">
                <input type="number" name="attr_number">
                <input type="text" name="attr_eq_type_clean" readonly>
                <input type="text" name="attr_name" readonly>
                <input type="text" name="attr_text" readonly>
              </div>
            </div>
          </fieldset>
        </div>
      </div>
      <!--[FATE]-->
    <div class="sheet-fate">
        <!--[FATEWEAVING]-->
        <div class="fateweaving-main">
          <span>FATEWEAVING</span>
          <div class="thread">
          <label for="thread">Thread of Fate: </label>
          <input type="text" name="attr_fate_thread" placeholder="...">
        </div>
        <div class="fate-notes">
          <span>FATEWEAVING NOTES</span>
          <textarea name="attr_fate_note" placeholder="..."></textarea>
        </div>
        <div class="fate-reward">
          <span>FATEWEAVING REWARDS</span>
          <textarea name="attr_fate_reward" placeholder="..."></textarea>
        </div>
        </div>
        <!--[CURSE]-->
        <div class="curse-main">
          <span>CURSE</span>
          <textarea name="attr_curse" placeholder="..."></textarea>
        </div>
        <!--[DARK BARGAINS]-->
        <div class="bargain-main">
          <span>DARK BARGAINS</span>
          <div class="bargain">
            <span>BARGAIN 1</span>
            <textarea name="attr_bargain_1" placeholder="..."></textarea>
          </div>
          <div class="bargain">
            <span>BARGAIN 2</span>
            <textarea name="attr_bargain_2" placeholder="..."></textarea>
          </div>  
          <div class="bargain">
            <span>BARGAIN 3</span>
            <textarea name="attr_bargain_3" placeholder="..."></textarea>
          </div>
        </div>
        <!--[NOTES]-->
        <div class="notes-main">
          <span>NOTES</span>
          <textarea name="attr_notes" placeholder="..."></textarea>
        </div>
    </div>
      <!--[OPTIONS]-->
    <div class="sheet-options">
        <!--[EXPERTISE - SKILLS - JACK]-->
        <div class="skill-options-main">
          <span>SKILL OPTIONS</span>
          <!--half_prof.floor in non prof things-->
          <div class="skill-jack">
            <input type="checkbox" name="attr_jack" value="1">
            <span>[JACK OF ALL TRADES]</span>
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_athl_expe" value="1">
            <span>Athletics</span>
            <span>+</span>
            <input type="number" name="attr_athl_optional_bonus" value="@{athl_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_athl_bonus" value="@{athl_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_acro_expe" value="1">
            <span>Acrobatics</span>
            <span>+</span>
            <input type="number" name="attr_acro_optional_bonus" value="@{acro_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_acro_bonus" value="@{acro_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_slei_expe" value="1">
            <span>Sleight of Hand</span>
            <span>+</span>
            <input type="number" name="attr_slei_optional_bonus" value="@{slei_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_slei_bonus" value="@{slei_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_stea_expe" value="1">
            <span>Stealth</span>
            <span>+</span>
            <input type="number" name="attr_stea_optional_bonus" value="@{stea_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_stea_bonus" value="@{stea_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_arca_expe" value="1">
            <span>Arcana</span>
            <span>+</span>
            <input type="number" name="attr_arca_optional_bonus" value="@{arca_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_arca_bonus" value="@{arca_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_hist_expe" value="1">
            <span>History</span>
            <span>+</span>
            <input type="number" name="attr_hist_optional_bonus" value="@{hist_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_hist_bonus" value="@{hist_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_inve_expe" value="1">
            <span>Investigation</span>
            <span>+</span>
            <input type="number" name="attr_inve_optional_bonus" value="@{inve_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_inve_bonus" value="@{inve_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_natu_expe" value="1">
            <span>Nature</span>
            <span>+</span>
            <input type="number" name="attr_natu_optional_bonus" value="@{natu_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_natu_bonus" value="@{natu_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_reli_expe" value="1">
            <span>Religion</span>
            <span>+</span>
            <input type="number" name="attr_reli_optional_bonus" value="@{reli_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_reli_bonus" value="@{reli_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_anim_expe" value="1">
            <span>Animal Handling</span>
            <span>+</span>
            <input type="number" name="attr_anim_optional_bonus" value="@{anim_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_anim_bonus" value="@{anim_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_insi_expe" value="1">
            <span>Insight</span>
            <span>+</span>
            <input type="number" name="attr_insi_optional_bonus" value="@{insi_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_insi_bonus" value="@{insi_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_medi_expe" value="1">
            <span>Medicine</span>
            <span>+</span>
            <input type="number" name="attr_medi_optional_bonus" value="@{medi_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_medi_bonus" value="@{medi_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_perc_expe" value="1">
            <span>Perception</span>
            <span>+</span>
            <input type="number" name="attr_perc_optional_bonus" value="@{perc_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_perc_bonus" value="@{perc_bonus}">
          </div>
          <div class="skill-option">
            <span>Passive Perception</span>
            <span>+</span>
            <input type="number" name="attr_pass_optional_bonus" value="@{pass_optional_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_surv_expe" value="1">
            <span>Survival</span>
            <span>+</span>
            <input type="number" name="attr_surv_optional_bonus" value="@{surv_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_surv_bonus" value="@{surv_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_dece_expe" value="1">
            <span>Deception</span>
            <span>+</span>
            <input type="number" name="attr_dece_optional_bonus" value="@{dece_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_dece_bonus" value="@{dece_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_inti_expe" value="1">
            <span>Intimidation</span>
            <span>+</span>
            <input type="number" name="attr_inti_optional_bonus" value="@{inti_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_inti_bonus" value="@{inti_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_perf_expe" value="1">
            <span>Performance</span>
            <span>+</span>
            <input type="number" name="attr_perf_optional_bonus" value="@{perf_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_perf_bonus" value="@{perf_bonus}">
          </div>
          <div class="skill-option">
            <input type="checkbox" name="attr_pers_expe" value="1">
            <span>Persuasion</span>
            <span>+</span>
            <input type="number" name="attr_pers_optional_bonus" value="@{pers_optional_bonus}">
            <span>value:</span>
            <input type="number" name="attr_pers_bonus" value="@{pers_bonus}">
          </div>
        </div>
        <!--[HIT DIE]-->
        <div class="dice-option-main">
          <span>Hit Dice:</span>
          <input type="text" name="attr_hd_dice" value="@{hd_dice}">
        </div>  
    </div>
  </div>
  <!--[NPC-SHEET-MAIN]-->
  <div class="sheet-block-npc">
    <span>[NPC]</span>
  </div>
  <!--[ROLLTEMPLATE]-->
</div>
<script type="text/worker"> 
  // [VARIABLES]
  const mainButton = ["core","spells","fate","options"];
  const eq_button = ['null','weapon', 'armor', 'magic','food','components','remedy','other'];
  const stats = ['str', 'dex', 'con', 'int', 'wis', 'cha'];
  const skills_name = ['athl', 'acro', 'slei', 'stea', 
                       'arca', 'hist', 'inve', 'natu',
                       'reli', 'anim', 'insi', 'medi',
                       'perc', 'surv', 'dece', 'inti', 
                       'perf', 'pers'];

  const armor = new Map ([
    ['padded','11'],['leather', '11'],['studded','12'],
    ['hide', '12'],['chain shirt','13'],['scale mail', '14'],
    ['breastplate','14'],['half plate','15'],['ring mail','14'],
    ['chain mail','16'],['splint','17'],['plate','18'],['shield','1']
  ]);
  const skills = new Map ([
    ['athl', stats[0]],['acro', stats[1]],['slei', stats[1]],['stea', stats[1]],
    ['arca', stats[3]],['hist', stats[3]],['inve', stats[3]],['natu', stats[3]],
    ['reli', stats[3]],['anim', stats[4]],['insi', stats[4]],['medi', stats[4]],
    ['perc', stats[4]],['surv', stats[4]],['dece', stats[5]],['inti', stats[5]],
    ['perf', stats[5]],['pers', stats[5]]
  ]);
  const class_dice = new Map ([
    ['Barbarian', 'd12'],['Bard', 'd8'],['Cleric', 'd8'],['Druid', 'd8'],
    ['Fighter', 'd10'],['Monk', 'd8'],['Paladin', 'd10'],['Ranger', 'd10'],
    ['Rogue', 'd8'],['Sorcerer', 'd6'],['Warlock', 'd8'],['Wizard', 'd6']
  ]);
  const change_attack = [ 
  'is_attack','attack_bonus','optional_attack_mod','is_prof','magic_bonus',
  'is_damage_1','damage_dice_1','damage_bonus_1','optional_damage_mod_1',
  'damage_type_1','is_damage_2','damage_dice_2','damage_bonus_2','optional_damage_mod_2',
  'damage_type_2','is_save','attack_save_stat'];
  const change_tools = ['name','bonus','ability','mod'];
  // Bard, Cleric, Druid, Sorcerer, Wizard
  const full_caster = {
    1:  [2,0,0,0,0,0,0,0,0],
    2:  [3,0,0,0,0,0,0,0,0],
    3:  [4,2,0,0,0,0,0,0,0],
    4:  [4,3,0,0,0,0,0,0,0],
    5:  [4,3,2,0,0,0,0,0,0],
    6:  [4,3,3,0,0,0,0,0,0],
    7:  [4,3,3,1,0,0,0,0,0],
    8:  [4,3,3,2,0,0,0,0,0],
    9:  [4,3,3,3,1,0,0,0,0],
    10: [4,3,3,3,2,0,0,0,0],
    11: [4,3,3,3,2,1,0,0,0],
    12: [4,3,3,3,2,1,0,0,0],
    13: [4,3,3,3,2,1,1,0,0],
    14: [4,3,3,3,2,1,1,0,0],
    15: [4,3,3,3,2,1,1,1,0],
    16: [4,3,3,3,2,1,1,1,0],
    17: [4,3,3,3,2,1,1,1,1],
    18: [4,3,3,3,3,1,1,1,1],
    19: [4,3,3,3,3,2,1,1,1],
    20: [4,3,3,3,3,2,2,1,1]
  };
  // Paladin, Ranger
  const half_caster = {
    1:  [2,0,0,0,0,0,0,0,0],
    2:  [2,0,0,0,0,0,0,0,0],
    3:  [3,0,0,0,0,0,0,0,0],
    4:  [3,0,0,0,0,0,0,0,0],
    5:  [4,2,0,0,0,0,0,0,0],
    6:  [4,2,0,0,0,0,0,0,0],
    7:  [4,3,0,0,0,0,0,0,0],
    8:  [4,3,0,0,0,0,0,0,0],
    9:  [4,3,2,0,0,0,0,0,0],
    10: [4,3,2,0,0,0,0,0,0],
    11: [4,3,3,0,0,0,0,0,0],
    12: [4,3,3,0,0,0,0,0,0],
    13: [4,3,3,1,0,0,0,0,0],
    14: [4,3,3,1,0,0,0,0,0],
    15: [4,3,3,2,0,0,0,0,0],
    16: [4,3,3,2,0,0,0,0,0],
    17: [4,3,3,3,1,0,0,0,0],
    18: [4,3,3,3,1,0,0,0,0],
    19: [4,3,3,3,2,0,0,0,0],
    20: [4,3,3,3,2,0,0,0,0],
  };
  // Warlock
  const warlock_caster = {
    1:  [1,0,0,0,0,0,0,0,0],
    2:  [2,0,0,0,0,0,0,0,0],
    3:  [0,2,0,0,0,0,0,0,0],
    4:  [0,3,0,0,0,0,0,0,0],
    5:  [0,0,2,0,0,0,0,0,0],
    6:  [0,0,2,0,0,0,0,0,0],
    7:  [0,0,0,2,0,0,0,0,0],
    8:  [0,0,0,2,0,0,0,0,0],
    9:  [0,0,0,0,2,0,0,0,0],
    10: [0,0,0,0,2,0,0,0,0],
    11: [0,0,0,0,3,0,0,0,0],
    12: [0,0,0,0,3,0,0,0,0],
    13: [0,0,0,0,3,0,0,0,0],
    14: [0,0,0,0,3,0,0,0,0],
    15: [0,0,0,0,3,0,0,0,0],
    16: [0,0,0,0,3,0,0,0,0],
    17: [0,0,0,0,4,0,0,0,0],
    18: [0,0,0,0,4,0,0,0,0],
    19: [0,0,0,0,4,0,0,0,0],
    20: [0,0,0,0,4,0,0,0,0],
  };
  // [FUNCTION]
  function build_mod(entries) {
    let changes = [];
    for (let i=0; i< entries.length;i++){ 
      let change = `${entries[i].toLowerCase()}_mod`;
      changes.push(change);
    }
    return changes;
  };
  function build_bonus(entries) {
    let changes = [];
    for (let i=0; i< entries.length;i++){ 
      let change = `${entries[i].toLowerCase()}_bonus`;
      changes.push(change);
    }
    return changes;
  };
  function build_changes_mod(entries) {
    let changes = '';
    entries.forEach(function(entry) {
      changes += `change:${entry.toLowerCase()}_mod `;
    });
    return changes;
  };
  function build_changes_bonus(entries) {
    let changes = '';
    entries.forEach(function(entry) {
      changes += `change:${entry.toLowerCase()}_bonus `;
    });
    return changes;
  };
  function build_changes_repeat_attack(entries) {
    let changes = '';
    entries.forEach(function(entry) {
      changes += `change:repeating_attack:${entry.toLowerCase()} `;
    });
    return changes;
  };
  function build_changes_repeat_tools(entries) {
    let changes = '';
    entries.forEach(function(entry) {
      changes += `change:repeating_tools:${entry.toLowerCase()} `;
    });
    return changes;
  };
  function get_by_value(map, search){
    const keys =[];
    for (let [key, value] of map.entries()){
      if (value === search) keys.push(key);
    }
    return keys;
  }
  function get_by_key(map, search){
    const values = [];
    for (let [key, value] of map.entries()){
      if (key === search) values.push(value);
    }
    return values;
  }
  function int(score, number = 0) {
    return parseInt(score) || number;
  }
  function mod(stat){
    const stat_score = int(stat,10);
    return Math.floor(stat_score/2) -5;
  }
  function save(save, prof, mod){
    const stat_prof = int(prof,2);
    const stat_save = int(save,0);
    const stat_mod = mod;
    return stat_mod+(stat_prof*stat_save);
  }
  function skill_mod(skill, prof, mod, expe, optional, jack_check){
    const skill_check = int(skill,0);
    const prof_bonus = int(prof,2);
    const stat_mod = mod;
    const skill_expe = int(expe,0);
    const skill_optional = int(optional,0);
    const jack = int(jack_check,0);
    if (skill_check === 0 && jack === 0) return stat_mod+skill_optional;
    else if (skill_check === 0 && jack === 1) return stat_mod+skill_optional+ Math.floor(prof_bonus/2);
    else return stat_mod+(prof_bonus+prof_bonus*skill_expe)+skill_optional;
  }

  // [ ABILITY - MOD - SKILL - SKILL_OPTIONAL - SAVE - INIT - PASSIVE ]
  stats.forEach(stat => {
    on(`change:${stat} change:${stat}_save ${build_changes_bonus(get_by_value(skills,stat))} change:prof_bonus`,() => {
      //console.log(`-- mod i wgl --`);
      getAttrs([stat,...get_by_value(skills,stat),stat+"_save","prof_bonus",...build_bonus(get_by_value(skills,stat))], values => {
        const output = {};
        let key = '';
        let skill_bonus;
        const stat_mod = mod(values[stat]);
        const stat_save = save(values[stat+"_save"],values.prof_bonus, stat_mod);
        const skill_list = [...get_by_value(skills,stat)];
        for (let i=0; i<skill_list.length;i++){
          key = skill_list[i]+"_bonus";
          skill_bonus = int(values[key],0);
          output[key] = skill_bonus;
        }
        key = `${stat}_mod`;
        output[key] = stat_mod;
        key = `${stat}_save_bonus`;
        output[key] = stat_save;
        if (stat === 'dex'){
          const initiative = stat_mod;
          key = `initiative`;
          output[key] = initiative;
        }
        setAttrs(
          output,
          {silent:false}
        );
      });
    });
  });

  // [SKILL BONUS]
  skills_name.forEach(skill => {
    on(`${build_changes_mod(get_by_key(skills,skill))} change:${skill} change:${skill}_expe change:${skill}_optional_bonus change:prof_bonus change:jack`,() => {
        console.log(`-- skill_bonus --`);
      getAttrs([skill, skill+"_expe", skill+"_optional_bonus",...build_mod(get_by_key(skills,skill)),"prof_bonus","pass_optional_bonus", "jack"], values => {
        let pass_per;
        const stat_mod = [...build_mod(get_by_key(skills,skill))];
        skill_bonus = skill_mod(values[skill],values.prof_bonus,values[stat_mod],values[skill+"_expe"],values[skill+"_optional_bonus"],values.jack);
         const output = {
          [`${skill}_bonus`]: skill_bonus,
        }
        if (skill === 'perc') {
          let check = int(values.perc,0);
          let pass_optional = int(values.pass_optional_bonus,0);
          let jack_check = int(values.jack,0);
          if (check === 0 && jack_check === 1) pass_per = 10+values[stat_mod]+pass_optional+Math.floor(values.prof_bonus/2);
          else pass_per = 10+values[stat_mod]+values.prof_bonus+pass_optional;
          output.pass_bonus = pass_per;
        }
        //console.log(output);
        setAttrs(
          output,
          {silent:true}
        );
      });
    });
  });

  // [PROF_BONUS - HIT DICE - STRESS]
  on(`change:level change:stress_max`,() =>{
    getAttrs(["level", "stress_max", "stress"], values => {
      const level = int(values.level,1);
      const stress = int(values.stress_max,0);
      const stress_c = int(values.stress,0);
      let treshold;
      let door;
      let bonus;
      if (stress_c <= stress) treshold = stress - stress_c;
      if (stress_c <= stress*2) door = stress*2 - stress_c;
      if (level <= 4) bonus = 2;
      else if (level <= 8) bonus = 3;
      else if (level <= 12) bonus = 4;
      else if (level <= 16) bonus = 5;
      else if (level <= 20) bonus = 6;
      setAttrs({
        hd_max: level,
        prof_bonus: bonus,
        stress_treshold: treshold,
        stress_door: door,
        silent: true
      });
    });
  });

  // [CLASS - SPELL-ABILITY]
  const class_name = [];
  for (const key of class_dice.keys()) {
    class_name.push(key);
  }
  on('change:class', (eventInfo) => {
    const name = eventInfo.newValue;
    const dice = get_by_key(class_dice,name);
    let spell_ability_mod;
    switch (name){
      case 'Bard':
      case 'Paladin':
      case 'Sorcerer':
        spell_ability_mod = 3; break;
      case 'Cleric':
      case 'Druid':
      case 'Ranger':
      case 'Warlock':
        spell_ability_mod = 2; break;
      case 'Wizard':
        spell_ability_mod = 1; break;
      default:
        spell_ability_mod = 0;
    }
    setAttrs({
      hd_dice: dice,
      spell_ability: spell_ability_mod
    });
  });

  // [SPELL]
  on(`change:int_mod change:wis_mod change:cha_mod change:prof_bonus change:class`,() =>{
    //console.log(`-- spell-mod --`);
    getAttrs(['spell_ability','int_mod','wis_mod','cha_mod','prof_bonus'],values => {
      const prof = int(values.prof_bonus,2);
      const ability = int(values.spell_ability,0);
      const output = {};
      let mod;
      switch (ability){
        case 1:
          mod = int(values.int_mod); break;
        case 2:
          mod = int(values.wis_mod); break;
        case 3:
          mod = int(values.cha_mod); break;
      }
      if (ability > 0 ){
        output[`spell_mod`]= mod;
        output[`spell_save`] = 8+mod+prof;
        output[`spell_attack_bonus`] = mod+prof;
      }
      else{
        output[`spell_mod`]= 0;
        output[`spell_save`] = 0;
        output[`spell_attack_bonus`] = 0;
      }
      //console.log(output);
      setAttrs(
        output,
        {silent:true}
      );
    });
  });

  // [SPELL SLOTS]
  on(`change:class change:level`,() => {
    //console.log(`-- spell-slots --`);
    getAttrs(['level','class'], values => {
      const pc_level = values.level;
      const name = values.class;
      let slots = [];
      const output = {};
      switch (name){
        case 'Bard':
        case 'Cleric':
        case 'Driud':
        case 'Sorcerer':
        case 'Wizard':
          slots = [...full_caster[pc_level]]; break;
        case 'Paladin':
        case 'Range':
          slots = [...half_caster[pc_level]]; break;
        case 'Warlock':
          slots = [...warlock_caster[pc_level]]; break;
        default:
          for (let i=0; i<9; i++){
            slots[i] = 0;
          }
          break;
      }
      for(let i=0; i<9; i++){
        output[`spell_lvl_${i+1}_total`] = slots[i];
      }
      console.log(output);
      setAttrs(
        output,
        {silent:true}
      );
    });
  });

  const section_name = (section, id, field) => `repeating_${section}_${id}_${field}`;

  // [EQ - CHANGE - TAG]
  on(`change:repeating_eq:eq_type`,() => {
    console.log(`-- repeating_eq_tag --`);
    getSectionIDs('repeating_eq', ids => {
      const fields = ids.reduce((all, id) => [...all, section_name('eq', id, 'eq_type')], []);
      getAttrs([...fields], values => {
        const output = {};
        ids.forEach(id => {
          const tag = int(values[section_name('eq', id, 'eq_type')],0);
          let clean_tag;
          switch (tag){
            case 0: clean_tag = '[W]'; break;
            case 1: clean_tag = '[A]'; break;
            case 2: clean_tag = '[M]'; break;
            case 3: clean_tag = '[F]'; break;
            case 4: clean_tag = '[C]'; break;
            case 5: clean_tag = '[R]'; break;
            case 6: clean_tag = '[O]'; break
            default: clean_tag = '[-]';
          }
          output[section_name('eq', id, 'eq_type_clean')] = clean_tag;
          //console.log(`${tag}:${clean_tag}`);
        });
        setAttrs(output);
      });
    });
  });

  // [EQ - FILTER]
  eq_button.forEach(button => {
    on(`clicked:eq_${button}`,() => {
      //console.log(`-- repeating_eq_filter --`);
      getSectionIDs('repeating_eq', ids => {
        const fields = ids.reduce((all,id) => [...all,section_name('eq', id, 'eq_type')], []);
        getAttrs([...fields, 'eq_'+button], values => {
          const output = {};
          ids.forEach(id => {
            const filter_type = int(values["eq_"+button],0);
            const this_eq_type = int(values[section_name('eq', id, 'eq_type')],0);
            output[section_name('eq', id, 'show')] = (filter_type === -1 || filter_type === this_eq_type) ? 1 : 0;
          });
          setAttrs(output);
        });
      });
    });
  });

  // [AC]
  on(`change:dex_mod change:repeating_eq:name change:repeating_eq:eq_type`,() => {
    console.log(`-- armore class --`);
    getSectionIDs(`repeating_eq`, ids => {
      const fields = ids.reduce((all, id) => [...all,
      section_name('eq', id, 'name'), 
      section_name('eq', id, 'eq_type')], []);
      getAttrs([...fields, 'dex_mod', 'ac', 'con_mod','wis_mod','class'], values => {
        const output = {};
        const stat_mod = int(values.dex_mod,0);
        const armor_name = [];
        const class_name = values.class;
        const ac_stat = int(values.ac,0);
        const con = int(values.con_mod,0);
        const wis = int(values.wis_mod,0);
        let stat;
        let ac_temp;
        let ac= ac_stat;
        for( const x of armor.keys()) {
          armor_name.push(x)
        }
        ids.forEach(id => {
          const eq_name = values[section_name('eq', id, 'name')];
          const eq_type = int(values[section_name('eq', id, 'eq_type')],0);
          if(eq_type === 1){
            for(let i=0; i<armor.size; i++){
              let result = eq_name.search(armor_name[i]);
              if (result > -1){
                switch (eq_name){
                  case 'padded':
                  case 'leather':
                  case 'studded':
                    stat = int(get_by_key(armor,armor_name[i]),0);
                    ac_temp = stat+stat_mod;
                    if(ac < ac_temp){
                      ac = ac_temp;
                    }
                    break;
                  case 'hide':
                  case 'chain shirt':
                  case 'scale mail':
                  case 'breastplate':
                  case 'half plate':
                    if (stat_mod > 2) stat_mod = 2;
                    stat = int(get_by_key(armor,armor_name[i]),0);
                    ac_temp = stat+stat_mod;
                    if(ac < ac_temp){
                      ac = ac_temp;
                    }
                    break;
                  case 'ring mail':
                  case 'chain mail':
                  case 'splint':
                  case 'plate':
                    stat = int(get_by_key(armor,armor_name[i]),0);
                    ac_temp = stat;
                    if(ac < ac_temp){
                      ac = ac_temp;
                    } 
                    break;
                  case 'shield':
                    if (class_name == 'Monk') ac = ac;
                    else {ac = ac + 2;}
                    break;
                }
              }
              else if (class_name == 'Barbarian') ac = 10+stat_mod+con;
              else if (class_name == 'Monk') ac = 10+stat_mod+wis;
              output[`ac`]= ac;
            }
          }
          //console.log(output);
        });
        setAttrs(
          output,
          {silent:true}
        );
      });
    });
  });

  // [REPEATING - TOOLS]
  on(`${build_changes_repeat_tools(change_tools)} ${build_changes_mod(stats)}`,() => {
    console.log(`-- repeating_tools --`);
    getSectionIDs('repeating_tools', ids => {
      const fields = ids.reduce((all,id) => [...all,
      section_name('tools', id, 'bonus'),
      section_name('tools', id, 'ability'),
      section_name('tools', id, 'mod')], []);
      getAttrs([...fields,...build_mod(stats),'prof_bonus'],values => {
        const output = {};
        const prof = int(values.prof_bonus,2);
        ids.forEach(id => {
          const ability = values[section_name('tools', id, 'ability')];
          const bonus = int(values[section_name('tools', id, 'bonus')],0);
          const mod = int(values[section_name('tools', id, 'mod')],0);
          let full_bonus;
          let stat_bonus;
          stats.forEach(stat => {
            if (ability === stat) stat_bonus = int(values[stat+'_mod'],0);
          });
          if (bonus === -1) full_bonus = 0+stat_bonus+mod;
          else if (bonus === 0) full_bonus = prof+stat_bonus+mod;
          else if (bonus === 1) full_bonus = 2*prof+stat_bonus+mod;
          else full_bonus = Math.floor(prof/2)+stat_bonus+mod;
          output[section_name('tools', id, 'full_bonus')] = full_bonus;
        });
        //console.log(output);
        setAttrs(
          output,
          {silent:true}
        );
      });
    });
  });
  
  // [REPEATING - ATTACK]
  on(`${build_changes_repeat_attack(change_attack)} ${build_changes_mod(stats)} change:prof_bonus`,() => {
    //console.log(`-- repeating_attack --`);
    getSectionIDs(`repeating_attack`, ids => {
      const fields = ids.reduce((all, id) => [...all, 
      section_name('attack', id, 'is_attack'),
      section_name('attack', id, 'attack_bonus'), 
      section_name('attack', id, 'optional_attack_mod'),
      section_name('attack', id, 'is_prof'),
      section_name('attack', id, 'magic_bonus'),
      section_name('attack', id, 'is_damage_1'), 
      section_name('attack', id, 'damage_dice_1'),
      section_name('attack', id, 'damage_bonus_1'), 
      section_name('attack', id, 'optional_damage_mod_1'),
      section_name('attack', id, 'damage_type_1'), 
      section_name('attack', id, 'is_damage_2'),
      section_name('attack', id, 'damage_dice_2'), 
      section_name('attack', id, 'damage_bonus_2'),
      section_name('attack', id, 'optional_damage_mod_2'), 
      section_name('attack', id, 'damage_type_2'),
      section_name('attack', id, 'is_save'), 
      section_name('attack', id, 'attack_save_stat')], []);
      getAttrs([...fields, ...build_mod(stats), 'prof_bonus', 'spell_save', 'spell_attack_bonus', 'spell_mod'], values => {
        const output = {};
        ids.forEach(id => {
          const attack_check = int(values[section_name('attack', id, 'is_attack')],0);
          const damage_check_1 = int(values[section_name('attack', id, 'is_damage_1')],0);
          const damage_check_2 = int(values[section_name('attack', id, 'is_damage_2')],0);
          const save_check = int(values[section_name('attack', id, 'is_save')],0);
          let mod;
          let mod_bonus;
          let atk_bonus;
          let atk_damage;
          if(attack_check === 1){
            const prof_check = int(values[section_name('attack', id, 'is_prof')],0);
            const optional = int(values[section_name('attack', id, 'optional_attack_mod')],0);
            const magic_bonus = int(values[section_name('attack', id, 'magic_bonus')],0);
            const prof = int(values.prof_bonus,0);
            mod = values[section_name('attack', id, 'attack_bonus')];
            stats.forEach(stat => {
              if (mod === stat) mod_bonus = int(values[stat+"_mod"],0);
            })
            if (mod === 'spe') mod_bonus = int(values.attr_spell_mod,0);
            const atk_bonus_val = mod_bonus + optional + (prof*prof_check) + magic_bonus;
            atk_bonus = `+${atk_bonus_val}`;
          }
          if(save_check === 1 && attack_check === 0){
            mod = values[section_name('attack', id, 'attack_save_stat')];
            const save = int(values.spell_save,0);
            stats.forEach(stat => {
              if (mod === stat) mod_bonus = int(values[stat+"_mod"],0);
            })
            if (mod != 'spe'){
              const atk_save = mod_bonus + 10;
              atk_bonus = `DC:${atk_save}`;
            }
            else atk_bonus = `DC:${save}`;
          }
          if (save_check === 0 && attack_check === 0) atk_bonus = `--`;
          if (damage_check_1 === 1){
            const optional = int(values[section_name('attack', id, 'optional_damage_mod_1')],0);
            const dice = values[section_name('attack', id, 'damage_dice_1')];
            const dmg_type = values[section_name('attack', id, 'damage_type_1')];
            mod = values[section_name('attack', id, 'damage_bonus_1')];
            stats.forEach(stat => {
              if (mod === stat) mod_bonus = int(values[stat+"_mod"],0);
            })
            if (mod === 'spe') mod_bonus = int(values.spell_attack_bonus,0);
            const dmg_bonus = mod_bonus + optional;
            atk_damage = `${dice}+${dmg_bonus} ${dmg_type}`;
          }
          if (damage_check_2 === 1 && damage_check_1 === 1){
            mod=0;
            const optional = int(values[section_name('attack', id, 'optional_damage_mod_2')],0);
            const dice = values[section_name('attack', id, 'damage_dice_2')];
            const dmg_type = values[section_name('attack', id, 'damage_type_2')];
            mod = values[section_name('attack', id, 'damage_bonus_2')];
            stats.forEach(stat => {
              if (mod === stat) mod_bonus = int(values[stat+"_mod"],0);
            })
            if (mod === 'spe') mod_bonus = int(values.spell_attack_bonus,0);
            const dmg_bonus = mod_bonus + optional;
            atk_damage += ` ${dice}+${dmg_bonus} ${dmg_type}`;
          }
          else if (damage_check_1 === 0 && damage_check_2 === 1) atk_damage = `--`;
          else if (damage_check_1 === 0 && damage_check_2 === 0) atk_damage = `--`;
          output[section_name('attack', id, 'atk_bonus')] = atk_bonus;
          output[section_name('attack', id, 'atk_damage')] = atk_damage;
        });
        setAttrs(
          output,
          {silent: true}
        );
      });
    });
  });

  // [BUTTONS]
  mainButton.forEach(button => {
      on(`clicked:${button}` , function() {
          setAttrs({
              sheetTab: button
          });
      });
  });
</script>